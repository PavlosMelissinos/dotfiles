#!/usr/bin/env bb
;; Script to get a field of an issue from JIRA.
;;
;; Example:
;;
;;   get-jira PROJ-666 summary
;;
;; In order for this to work you need to have this config in ~/.jira/config.edn
;;
;; {:site-url  "my-company.atlassian.net"
;;  :user      "my-email@my-company.com"
;;  :api-token "XXX"}
;;
;; Modify this as applicable
;; Original author: stathissideris


(alias 'http 'org.httpkit.client)

(def config (-> (str (System/getProperty "user.home") "/.config/jira/.config.edn") slurp edn/read-string))

(defn get-field [{:keys [site-url user api-token]} issue field]
  (-> (str "https://" site-url "/rest/api/3/issue/" issue "?fields=" field)
      (http/get {:basic-auth [user api-token]})
      deref
      :body
      json/parse-string
      (get-in ["fields" field])))

(let [[issue field] *command-line-args*]
  (println (get-field config issue field)))
